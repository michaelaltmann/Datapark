<!DOCTYPE html>
<html>
<head>
<title>DataPark</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" type="text/css" href="styles/datapark.css" />
<script type="text/javascript"
	src="lib/jquery-1.10.1.min.js"></script>

<script type="text/javascript">
	$(document).ready(function() {
		getResults();
	});

	function getResults() {
		// Should get these from the index.html
		var lon = -93.29;
		var lat = 44.92;
		var radius = 100;
		
		var spacesURL = 'http://michaelaltmann.cartodb.com/api/v2/sql';
		var vacancyURL = 'http://michaelaltmann.cartodb.com/api/v2/sql';

		$.getJSON(spacesURL, {
			q : "select sum(parking_supply.spaces) as tot from parking_supply where ST_Distance_Sphere(the_geom,ST_MakePoint("+lon+","+lat+")) < " + radius
		}, function(data) {
			var spaces = data.rows[0].tot;
			spaces = Math.round(spaces);
			$('#before_spaces').text(spaces);
		});
		$.getJSON(vacancyURL, {
			q : "select sum(parking_vacancy.vacancy) as tot from parking_vacancy where ST_Distance_Sphere(the_geom,ST_MakePoint("+lon+","+lat+")) < " + radius
		}, function(data) {
			var vacancy = data.rows[0].tot;
			vacancy = Math.round(vacancy);
			$('#before_vacancy').text(vacancy);
		});

	}
</script>
</head>
<body>
	<div id="container">
		<header>
			<div id="logo">
				<a href="index.html"><img height="100px" src="images/Plogo.jpg"
					width="100px" /></a>
			</div>
			<div>
				<a href="index.html"><h1 id="header-name">DataPark</h1></a>
			</div>
			<div id="main_nav">
				<ul class="menu">
					<li><a href="index.html">Home</a></li>
					<li><a href="results.html">Results</a></li>
				</ul>
			</div>
		</header>
		<div id="page_content">


			<table>
			<tr><td><h3>Before</h3></td> <td><h3>After</h3></td></tr>
				<tr>
					<td>
						<article id="before">
							Nearby parking spaces: <span id="before_spaces"></span> <br>Nearby vacant
							spaces: <span id="before_vacancy" > </span>
							<div id="before_map"><iframe src="http://cdb.io/15TDQSj" height="100%" width="100%"></iframe></div>
						</article>
					</td>
					<td><article id="after">
Nearby parking spaces: <span id="after_spaces" > </span><br> Nearby vacant
							spaces: <span id="after_vacancy" ></span>
							<div id="after_map"></div>
						</article></td>
				</tr>
			</table>

		</div>
		<!-- page_content -->
		<footer> </footer>
	</div>
	<!-- container -->
</body>
</html>
